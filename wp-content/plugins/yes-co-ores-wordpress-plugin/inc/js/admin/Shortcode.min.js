define("yog/admin/Shortcode",["dojo"],function(t){t.declare("yog.admin.Shortcode",null,{constructor:function(e,i){this._mapInstance=e,this._markerInstance=i,this._postTypesCheckboxes=t.query('input[name="shortcode_PostTypes[]"]');for(var n=0;n<this._postTypesCheckboxes.length;n++)t.connect(this._postTypesCheckboxes[n],"onclick",this,"_onInputFieldsChange");this._shortcodeElem=t.byId("yogShortcode"),this._inputLatitude=t.byId("shortcode_Latitude"),this._inputLongitude=t.byId("shortcode_Longitude"),this._inputWidth=t.byId("shortcode_Width"),this._inputWidthUnit=t.byId("shortcode_WidthUnit"),this._inputHeight=t.byId("shortcode_Height"),this._inputHeightUnit=t.byId("shortcode_HeightUnit"),this._inputLatitude&&this._inputLongitude&&(t.connect(this._inputLatitude,"onchange",this,"_onMarkerGeocodeInputFieldsChange"),t.connect(this._inputLongitude,"onchange",this,"_onMarkerGeocodeInputFieldsChange"),t.connect(this._inputWidth,"onchange",this,"_onInputFieldsChange"),t.connect(this._inputWidthUnit,"onchange",this,"_onInputFieldsChange"),t.connect(this._inputHeight,"onchange",this,"_onInputFieldsChange"),t.connect(this._inputHeightUnit,"onchange",this,"_onInputFieldsChange")),this._markerInstance.addListener("dragend",function(t){this._onMarkerDragEnd(t)}.bind(this)),this._mapInstance.addListener("zoom_changed",function(){this._onZoomLevelChanged()}.bind(this)),this._mapInstance.addListener("tilesloaded",function(){this._onMapLoaded()}.bind(this))},_onMapLoaded:function(){this.generateShortcode()},_onInputFieldsChange:function(){this.generateShortcode()},_onZoomLevelChanged:function(){this.generateShortcode()},_onMarkerDragEnd:function(t){this._mapInstance.setCenter(t.latLng),this._onMarkerPositionChanged()},generateShortcode:function(){for(var e="[yog-map ",i=[],n=0;n<this._postTypesCheckboxes.length;n++){var s=t.attr(this._postTypesCheckboxes[n],"checked"),h=t.attr(this._postTypesCheckboxes[n],"value");!0===s&&i.push(h)}if(i.length>0&&i.length<this._postTypesCheckboxes.length&&(e+=' post_types="'+i.join(",")+'"'),this._markerInstance){var o=this._markerInstance.position;e+=' center_latitude="'+o.lat()+'"',e+=' center_longitude="'+o.lng()+'"'}e+=' zoomlevel="'+this._mapInstance.zoom+'"',e+=' map_type="'+this._mapInstance.mapTypeId+'"';var a=t.attr(this._inputWidth,"value"),d=t.attr(this._inputHeight,"value");a>0&&(e+=' width="'+a+'"',e+=' width_unit="'+this._inputWidthUnit.options[this._inputWidthUnit.selectedIndex].value+'"');d>0&&(e+=' height="'+d+'"',e+=' height_unit="'+this._inputHeightUnit.options[this._inputHeightUnit.selectedIndex].value+'"');e+="]",this._shortcodeElem.innerHTML=e},_onMarkerGeocodeInputFieldsChange:function(e){if(this._markerInstance){var i=parseFloat(t.attr(this._inputLatitude,"value")),n=parseFloat(t.attr(this._inputLongitude,"value"));if(!isNaN(i)&&!isNaN(n)){var s=!0;if((i<-90||i>90)&&(t.addClass(this._inputLatitude,this.ERROR_CLASSNAME),t.attr(this._inputLatitude,"title","This value needs to be between -90 and 90 degree"),s=!1),(n<-180||n>180)&&(t.addClass(this._inputLongitude,this.ERROR_CLASSNAME),t.attr(this._inputLongitude,"title","This value needs to be between -180 and 180 degree"),s=!1),!0===s){var h={lat:i,lng:n};this._mapInstance.setCenter(h),this._markerInstance.setPosition(h),t.removeClass(this._inputLatitude,this.ERROR_CLASSNAME),t.removeClass(this._inputLongitude,this.ERROR_CLASSNAME),t.attr(this._inputLatitude,"title",""),t.attr(this._inputLongitude,"title",""),this._onMarkerPositionChanged()}}}},_onMarkerPositionChanged:function(){if(this._markerInstance){var e=this._markerInstance.position;t.attr(this._inputLatitude,"value",e.lat()),t.attr(this._inputLongitude,"value",e.lng()),t.removeClass(this._inputLatitude,this.ERROR_CLASSNAME),t.removeClass(this._inputLongitude,this.ERROR_CLASSNAME),t.attr(this._inputLatitude,"title",""),t.attr(this._inputLongitude,"title","")}this.generateShortcode()}})});